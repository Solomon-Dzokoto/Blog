#!/usr/bin/env sh

# Branch protection
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "dev" ]; then
    echo "ğŸš¨ Direct pushes to '$BRANCH' are restricted. ğŸš¨"
    echo "Please create a feature branch and push your changes there."
    exit 1
fi

echo "ğŸ” Running pre-commit checks..."

echo "ğŸ¨ Checking code formatting..."

# Check Prettier standards
pnpm run check-format ||
(
    echo "âš ï¸ Code formatting does not meet the required standards. Running auto-formatting..."
    npm run format;
    git add .;
    echo "âœ… Formatting applied. Amending the commit with updated formatting."
    git commit --amend --no-edit;
    echo "âœ… Formatting complete. Please retry your push."
)

echo "ğŸ” Running ESLint checks..."

# Check ESLint Standards
pnpm run lint ||
    (
        echo "âŒ ESLint checks failed. Please resolve the issues above before committing."
        false
    )

echo "ğŸ“Œ Checking for TypeScript errors..."

# Check TypeScript Standards
pnpm run check-types ||
    (
        echo "âŒ TypeScript compilation failed. Please fix the errors before proceeding."
        false
    )

# If all checks pass
echo "âœ… All checks passed. Proceeding with commit."

echo "ğŸš€ Push your changes using 'git push' to update the remote repository."
